# Milton Orchestrator Configuration
# Copy this file to .env and fill in your actual values

# ============================================
# REQUIRED SETTINGS
# ============================================

# Perplexity API Key (required)
# Get your key from: https://www.perplexity.ai/settings/api
PERPLEXITY_API_KEY=your_perplexity_api_key_here

# Target Repository (required)
# The repository where Claude Code will make changes
TARGET_REPO=/home/yourusername/your-project

# ============================================
# RUNTIME ENDPOINTS
# ============================================

# LLM API endpoint (vLLM OpenAI-compatible)
LLM_API_URL=http://localhost:8000

# LLM model name (must match vLLM served model name)
# Production target: Llama-3.1-8B-Instruct
LLM_MODEL=llama31-8b-instruct

# Weaviate endpoint (memory store)
WEAVIATE_URL=http://localhost:8080

# ============================================
# ntfy SETTINGS
# ============================================

# ntfy server URL
NTFY_BASE_URL=https://ntfy.sh

# Topic for incoming requests (from your iPhone)
ASK_TOPIC=milton-briefing-code-ask

# Topic for responses (to your iPhone)
ANSWER_TOPIC=milton-briefing-code

# Max chars for short status messages
NTFY_MAX_CHARS=160

# Max chars before switching to file output
NTFY_MAX_INLINE_CHARS=3000

# Directory for saved outputs (default: ~/.local/state/milton_orchestrator/outputs)
# OUTPUT_DIR=$HOME/milton/shared_outputs

# Base URL for Click-to-open output (from tailscale serve)
# OUTPUT_BASE_URL=https://<node>.<tailnet>.ts.net

# SMB share settings (alternative to Tailscale Click)
# OUTPUT_SHARE_URL=smb://<host>/<share>
# OUTPUT_SHARE_HOST=<host>
# OUTPUT_SHARE_NAME=<share>

# Always save output to file + Click URL (even if short)
ALWAYS_FILE_ATTACHMENTS=false

# Output filename template (uses {request_id})
OUTPUT_FILENAME_TEMPLATE=milton_{request_id}.txt

# Optional topic for Claude-specific requests
# CLAUDE_TOPIC=milton-briefing-claude

# Optional topic for Codex-specific requests
# CODEX_TOPIC=milton-briefing-codex

# ============================================
# PERPLEXITY SETTINGS
# ============================================

# Perplexity model to use
PERPLEXITY_MODEL=sonar-pro

# Timeout for Perplexity API calls (seconds)
PERPLEXITY_TIMEOUT=60

# Maximum retries for Perplexity API calls
PERPLEXITY_MAX_RETRIES=3

# Enable prefix-based routing (CLAUDE:/CODEX:/RESEARCH:/REMIND:/ALARM:)
ENABLE_PREFIX_ROUTING=true

# Enable/disable pipelines and modes
ENABLE_CLAUDE_PIPELINE=true
ENABLE_CODEX_PIPELINE=true
ENABLE_RESEARCH_MODE=true
ENABLE_REMINDERS=true

# Perplexity usage by mode
PERPLEXITY_IN_CLAUDE_MODE=true
PERPLEXITY_IN_CODEX_MODE=true
PERPLEXITY_IN_RESEARCH_MODE=true

# ============================================
# CLAUDE CODE SETTINGS
# ============================================

# Path to Claude Code binary
CLAUDE_BIN=claude

# Maximum timeout for Claude Code execution (seconds, 0 = no timeout)
CLAUDE_TIMEOUT=0

# Legacy request timeout (seconds, used for defaults)
REQUEST_TIMEOUT=600

# ============================================
# CODEX CLI SETTINGS
# ============================================

# Path to Codex CLI binary
CODEX_BIN=codex

# Codex model override (set to "default" to use CLI default)
CODEX_MODEL=gpt-5.2-codex

# Maximum timeout for Codex execution (seconds, 0 = no timeout)
CODEX_TIMEOUT=0

# Enable Claude-to-Codex fallback (set to "always" to fallback on any Claude failure)
ENABLE_CODEX_FALLBACK=true

# Only fallback on Claude usage/rate limits (set false to disable limit-only fallback)
CLAUDE_FALLBACK_ON_LIMIT=true

# Extra Codex CLI arguments (quoted string, optional)
# CODEX_EXTRA_ARGS="--some-flag --another-flag"

# ============================================
# LOGGING AND STATE
# ============================================

# Directory for log files
# LOG_DIR=$HOME/.local/state/milton_orchestrator/logs

# Directory for state files
# STATE_DIR=$HOME/.local/state/milton_orchestrator

# Maximum output size before truncation (characters)
MAX_OUTPUT_SIZE=4000

# ============================================
# NETWORK SETTINGS
# ============================================

# Maximum backoff time for ntfy reconnection (seconds)
NTFY_RECONNECT_BACKOFF_MAX=300
