#!/usr/bin/env bash
# Milton Runtime Environment Configuration
#
# This file serves dual purposes:
# 1. Shell script (source it): supports 'export' and variable expansion
# 2. systemd EnvironmentFile: plain KEY=VALUE format (no export, no expansion)
#
# When sourced by shell scripts, variable expansion works.
# When read by systemd, only literal values are used (expansions ignored).

# State directory - primary location for Milton's persistent data
# Shell scripts should set defaults via ${VAR:-default} when sourcing
# systemd will use these as-is without expansion
MILTON_STATE_DIR=$HOME/.local/state/milton
STATE_DIR=$MILTON_STATE_DIR

# Milton API server configuration
MILTON_API_URL=http://localhost:8001
MILTON_API_PORT=8001

# Milton Gateway (OpenAI-compatible chat API) configuration
GATEWAY_URL=http://localhost:8081
MILTON_CHAT_PORT=8081
MILTON_CHAT_HOST=127.0.0.1

# Backend LLM configuration
LLM_API_URL=http://localhost:8000
LLM_MODEL=llama31-8b-instruct

# Weaviate vector database configuration
WEAVIATE_URL=http://localhost:8080

# Gateway feature flags
# Set to 1 to enable memory retrieval in gateway, 0 to disable
MILTON_GATEWAY_MEMORY_RETRIEVAL=1

# Python configuration for better logging and error handling
PYTHONUNBUFFERED=1
PYTHONWARNINGS=default

# Export all variables when sourced by shell (but not when parsed by systemd)
if [ -n "${BASH_VERSION:-}" ]; then
    export MILTON_STATE_DIR STATE_DIR
    export MILTON_API_URL MILTON_API_PORT
    export GATEWAY_URL MILTON_CHAT_PORT MILTON_CHAT_HOST
    export LLM_API_URL LLM_MODEL
    export WEAVIATE_URL
    export MILTON_GATEWAY_MEMORY_RETRIEVAL
    export PYTHONUNBUFFERED PYTHONWARNINGS

    # Ensure log directory exists (when sourced)
    mkdir -p "$MILTON_STATE_DIR/logs" 2>/dev/null || true
fi
